# Configuración de Producción con mTLS (Mutual TLS)
# Este perfil se activa en Azure para comunicación segura con APIM

server:
  port: ${PORT:8443}
  ssl:
    enabled: true
    # KeyStore del servidor (contiene certificado y clave privada del servidor)
    key-store: classpath:server-keystore.p12
    key-store-password: ${SSL_KEYSTORE_PASSWORD:quickspeak-keystore-pass}
    key-store-type: PKCS12
    key-alias: server

    # Requerir certificado de cliente (mTLS)
    client-auth: need

    # TrustStore (contiene certificados de clientes confiables - APIM)
    trust-store: classpath:server-truststore.jks
    trust-store-password: ${SSL_TRUSTSTORE_PASSWORD:quickspeak-truststore-pass}
    trust-store-type: JKS

    # Protocolos TLS habilitados
    enabled-protocols: TLSv1.2,TLSv1.3

# Base de datos de producción (Azure SQL o PostgreSQL)
spring:
  datasource:
    url: ${DB_URL}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: ${DB_DRIVER:org.postgresql.Driver}

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        dialect: ${HIBERNATE_DIALECT:org.hibernate.dialect.PostgreSQLDialect}
        format_sql: false

  h2:
    console:
      enabled: false

# JWT
jwt:
  secret: ${JWT_SECRET}
  expiration: ${JWT_EXPIRATION:86400000}

# Logging en producción
logging:
  level:
    root: WARN
    com.yourteacher.userservice: INFO
    org.springframework.security: WARN
    org.hibernate.SQL: WARN

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: when-authorized
